<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoSaver - Interactive Challenges</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f4fff8 0%, #e1f7ef 100%);
        }
        .challenge-card {
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .challenge-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 35px rgba(32, 196, 182, 0.2);
        }
        .challenge-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        .challenge-card:hover::before {
            left: 100%;
        }
        .progress-bar {
            background: linear-gradient(90deg, #20c4b6 0%, #fd7e25 100%);
            border-radius: 10px;
            height: 8px;
            transition: width 0.5s ease;
        }
        .badge {
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        .game-area {
            min-height: 400px;
            border: 3px dashed #20c4b6;
            border-radius: 15px;
            position: relative;
        }
        .draggable {
            cursor: grab;
            transition: all 0.2s;
            user-select: none;
        }
        .draggable:hover {
            transform: scale(1.1) rotate(2deg);
            z-index: 10;
        }
        .draggable:active {
            cursor: grabbing;
            transform: scale(1.15) rotate(5deg);
        }
        .drop-zone {
            border: 2px dashed #ccc;
            transition: all 0.3s;
            min-height: 80px;
        }
        .drop-zone.active {
            border-color: #20c4b6;
            background: rgba(32, 196, 182, 0.1);
            transform: scale(1.05);
        }
        .memory-card {
            width: 80px;
            height: 80px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .memory-card.flipped {
            transform: rotateY(180deg);
        }
        .memory-card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            padding: 4px;
        }
        .memory-card-back {
            background: #20c4b6;
            color: white;
            transform: rotateY(180deg);
        }
        .memory-card-front {
            background: #e1f7ef;
        }
        .timer {
            font-family: 'Courier New', monospace;
            font-size: 2rem;
            font-weight: bold;
            color: #fd7e25;
        }
        .plant-stage {
            transition: all 0.5s ease;
            transform-origin: bottom center;
        }
        .plant-stage.grow {
            transform: scale(1.2);
        }
        .ecosystem-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 2px;
            width: 300px;
            height: 300px;
        }
        .ecosystem-cell {
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 2px;
        }
        .ecosystem-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        .floating-score {
            position: absolute;
            font-weight: bold;
            font-size: 1.2rem;
            color: #20c4b6;
            animation: floatUp 1s ease-out;
            pointer-events: none;
        }
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #20c4b6;
            border-radius: 50%;
            animation: particle 2s ease-out;
        }
        @keyframes particle {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0); opacity: 0; }
        }
        .challenge-difficulty {
            background: linear-gradient(45deg, #20c4b6, #fd7e25);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .daily-challenge {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(255, 107, 107, 0.3); }
            to { box-shadow: 0 0 30px rgba(254, 202, 87, 0.5); }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b-2 border-[#20c4b6] sticky top-0 z-40">
        <div class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="index.html" class="text-[#20c4b6] hover:text-[#fd7e25] font-semibold">‚Üê Back to Dashboard</a>
                <h1 class="text-2xl font-bold text-[#158a8e]">üéÆ Interactive Challenges</h1>
            </div>
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-4">
                    <div class="text-center">
                        <div class="text-lg font-bold challenge-difficulty" id="playerLevel">Level 1</div>
                        <div class="text-xs text-gray-500">EcoWarrior</div>
                    </div>
                    <div class="text-center">
                        <div class="text-lg font-bold text-[#20c4b6]" id="playerXP">0 XP</div>
                        <div class="text-xs text-gray-500">Experience</div>
                    </div>
                    <div class="text-center">
                        <div class="text-lg font-bold text-[#fd7e25]" id="playerBadges">0 üèÜ</div>
                        <div class="text-xs text-gray-500">Badges</div>
                    </div>
                    <div class="text-center">
                        <div class="text-lg font-bold text-purple-600" id="playerStreak">0 üî•</div>
                        <div class="text-xs text-gray-500">Streak</div>
                    </div>
                    <div class="text-center">
                        <div class="text-lg font-bold text-green-600" id="todayScore">0 ‚≠ê</div>
                        <div class="text-xs text-gray-500">Today</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="w-full bg-gray-200 h-3 relative">
            <div class="progress-bar w-0 h-full" id="xpProgress"></div>
            <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white" id="xpText">0/100 XP</div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <!-- Daily Challenge Banner -->
        <div class="daily-challenge rounded-xl p-6 mb-8 text-white text-center">
            <h2 class="text-2xl font-bold mb-2">üåü Daily Challenge</h2>
            <p class="mb-4" id="dailyChallengeText">Complete 3 challenges to earn bonus XP!</p>
            <div class="text-sm opacity-90" id="dailyTimer">Resets in: 23:45:12</div>
        </div>

        <!-- Challenge Categories -->
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-[#20c4b6]" onclick="showChallenges('water')">
                <div class="text-4xl mb-3">üíß</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Water Challenges</h3>
                <p class="text-sm text-gray-600">Conservation & Management</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-[#20c4b6] font-semibold">6 Challenges</span>
                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Easy-Hard</span>
                </div>
            </div>
            
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-[#fd7e25]" onclick="showChallenges('energy')">
                <div class="text-4xl mb-3">‚ö°</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Energy Challenges</h3>
                <p class="text-sm text-gray-600">Renewable & Efficiency</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-[#fd7e25] font-semibold">4 Challenges</span>
                    <span class="text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded">Medium</span>
                </div>
            </div>
            
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500" onclick="showChallenges('waste')">
                <div class="text-4xl mb-3">‚ôª</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Waste Management</h3>
                <p class="text-sm text-gray-600">Reduce, Reuse, Recycle</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-green-600 font-semibold">2 Challenges</span>
                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Easy</span>
                </div>
            </div>
            
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-purple-500" onclick="showChallenges('transport')">
                <div class="text-4xl mb-3">üö≤</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Green Transport</h3>
                <p class="text-sm text-gray-600">Sustainable Mobility</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-purple-600 font-semibold">1 Challenge</span>
                    <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">Medium</span>
                </div>
            </div>
            
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-pink-500" onclick="showChallenges('biodiversity')">
                <div class="text-4xl mb-3">üåø</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Biodiversity</h3>
                <p class="text-sm text-gray-600">Ecosystem & Wildlife</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-pink-600 font-semibold">3 Challenges</span>
                    <span class="text-xs bg-pink-100 text-pink-800 px-2 py-1 rounded">All Levels</span>
                </div>
            </div>
            
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-indigo-500" onclick="showChallenges('climate')">
                <div class="text-4xl mb-3">üå°</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Climate Action</h3>
                <p class="text-sm text-gray-600">Global Warming & Solutions</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-indigo-600 font-semibold">1 Challenge</span>
                    <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded">Hard</span>
                </div>
            </div>
            
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-yellow-500" onclick="showChallenges('food')">
                <div class="text-4xl mb-3">ü•¨</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Sustainable Food</h3>
                <p class="text-sm text-gray-600">Agriculture & Nutrition</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-yellow-600 font-semibold">1 Challenge</span>
                    <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">Easy-Medium</span>
                </div>
            </div>
            
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-500" onclick="showChallenges('pollution')">
                <div class="text-4xl mb-3">üè≠</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Pollution Control</h3>
                <p class="text-sm text-gray-600">Air, Water & Soil</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-red-600 font-semibold">1 Challenge</span>
                    <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">Medium-Hard</span>
                </div>
            </div>
        </div>

        <!-- Active Challenge Area -->
        <div id="challengeArea" class="bg-white rounded-xl shadow-lg p-8 hidden">
            <div id="challengeContent">
                <!-- Challenge content will be loaded here -->
            </div>
        </div>

        <!-- Leaderboard Section -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold text-[#158a8e] mb-4 flex items-center">
                <span class="mr-2">üèÖ</span> Today's Leaderboard
            </h2>
            <div id="leaderboard" class="space-y-3">
                <!-- Leaderboard will be populated by JS -->
            </div>
        </div>

        <!-- Achievements Panel -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold text-[#158a8e] mb-4 flex items-center">
                <span class="mr-2">üèÜ</span> Achievements & Badges
            </h2>
            <div id="achievementsGrid" class="grid md:grid-cols-6 gap-4">
                <!-- Achievements will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Completion Modal -->
    <div id="completionModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 text-center relative overflow-hidden">
            <div id="particles"></div>
            <div class="text-6xl mb-4 animate-bounce">üéâ</div>
            <h2 class="text-2xl font-bold text-[#158a8e] mb-2">Challenge Complete!</h2>
            <div id="rewardText" class="text-lg text-[#20c4b6] mb-4"></div>
            <div id="badgeReward" class="mb-6"></div>
            <div id="streakBonus" class="mb-4"></div>
            <button onclick="closeModal()" class="bg-[#20c4b6] text-white px-6 py-3 rounded-lg font-semibold hover:bg-[#1ba89e] transition-colors">
                Continue Learning
            </button>
        </div>
    </div>

    <!-- Timer Modal -->
    <div id="timerModal" class="fixed top-4 right-4 bg-white rounded-lg shadow-lg p-4 hidden z-50">
        <div class="text-center">
            <div class="text-sm text-gray-600 mb-1">Time Remaining</div>
            <div class="timer" id="gameTimer">05:00</div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            playerXP: 0,
            playerLevel: 1,
            badges: [],
            completedChallenges: [],
            currentStreak: 0,
            todayScore: 0,
            lastPlayDate: null,
            totalChallengesCompleted: 0,
            categoryProgress: {
                water: 0, energy: 0, waste: 0, transport: 0,
                biodiversity: 0, climate: 0, food: 0, pollution: 0
            }
        };

        // Load saved progress
        const savedState = localStorage.getItem('ecoGameState');
        if (savedState) {
            gameState = { ...gameState, ...JSON.parse(savedState) };
        }

        // Current challenge reference
        let currentChallenge = null;

        // Complete Challenge Database
        const challenges = {
            water: [
                {
                    id: 'water-1',
                    title: 'Water Drop Sorting',
                    type: 'drag-drop',
                    difficulty: 'Easy',
                    description: 'Sort water uses by efficiency level',
                    xp: 50,
                    timeLimit: 300,
                    content: {
                        items: ['Shower (20L/min)', 'Bucket Bath (15L)', 'Dishwasher (12L)', 'Hand Wash Dishes (25L)', 'Washing Machine (50L)', 'Dripping Tap (1L/hour)'],
                        categories: ['Efficient', 'Moderate', 'Wasteful'],
                        correct: {
                            'Efficient': ['Bucket Bath (15L)', 'Dishwasher (12L)'],
                            'Moderate': ['Shower (20L/min)', 'Washing Machine (50L)'],
                            'Wasteful': ['Hand Wash Dishes (25L)', 'Dripping Tap (1L/hour)']
                        }
                    }
                },
                {
                    id: 'water-2',
                    title: 'Water Memory Match',
                    type: 'memory',
                    difficulty: 'Medium',
                    description: 'Match water facts with their values',
                    xp: 60,
                    timeLimit: 180,
                    content: {
                        pairs: [
                            { id: 1, text: 'Daily water need per person', match: '2-3 Liters' },
                            { id: 2, text: 'Water in human body', match: '60%' },
                            { id: 3, text: 'Freshwater on Earth', match: '3%' },
                            { id: 4, text: 'Water for 1kg beef', match: '15,000L' },
                            { id: 5, text: 'Toilet flush volume', match: '6-9L' },
                            { id: 6, text: 'Leaky tap per day', match: '30L' }
                        ]
                    }
                },
                {
                    id: 'water-3',
                    title: 'Virtual Water Calculator',
                    type: 'calculator',
                    difficulty: 'Medium',
                    description: 'Calculate virtual water in everyday products',
                    xp: 70,
                    content: {
                        products: [
                            { name: 'Cotton T-shirt', water: 2700 },
                            { name: 'Cup of Coffee', water: 140 },
                            { name: 'Hamburger', water: 2400 },
                            { name: 'Sheet of Paper', water: 10 }
                        ]
                    }
                },
                {
                    id: 'water-4',
                    title: 'Rainwater Harvesting Simulator',
                    type: 'simulation',
                    difficulty: 'Hard',
                    description: 'Design optimal rainwater collection system',
                    xp: 100,
                    content: {
                        variables: ['Collection Efficiency', 'Storage Capacity', 'Filter System'],
                        constraints: { budget: 50000, space: 100 },
                        goal: 'Maximize water collection within constraints'
                    }
                },
                {
                    id: 'water-5',
                    title: 'Water Cycle Puzzle',
                    type: 'puzzle',
                    difficulty: 'Easy',
                    description: 'Complete the water cycle diagram',
                    xp: 40,
                    timeLimit: 240,
                    content: {
                        pieces: ['Evaporation', 'Condensation', 'Precipitation', 'Collection', 'Transpiration', 'Infiltration'],
                        correctOrder: ['Evaporation', 'Condensation', 'Precipitation', 'Collection', 'Infiltration', 'Transpiration']
                    }
                },
                {
                    id: 'water-6',
                    title: 'Water Quality Lab',
                    type: 'lab',
                    difficulty: 'Hard',
                    description: 'Test water samples and identify pollutants',
                    xp: 90,
                    content: {
                        samples: [
                            { id: 'A', ph: 6.5, turbidity: 'low', chlorine: 'normal', result: 'Safe' },
                            { id: 'B', ph: 4.2, turbidity: 'high', chlorine: 'low', result: 'Contaminated' },
                            { id: 'C', ph: 8.9, turbidity: 'medium', chlorine: 'high', result: 'Chemical pollution' }
                        ]
                    }
                }
            ],
            energy: [
                {
                    id: 'energy-1',
                    title: 'Solar Panel Builder',
                    type: 'builder',
                    difficulty: 'Medium',
                    description: 'Build optimal solar panel configuration',
                    xp: 80,
                    content: {
                        components: ['Solar Panel', 'Inverter', 'Battery', 'Grid Connection'],
                        constraints: { budget: 100000, space: 50, efficiency: 0.8 }
                    }
                },
                {
                    id: 'energy-2',
                    title: 'Energy Efficiency Race',
                    type: 'race',
                    difficulty: 'Easy',
                    description: 'Race to make a house energy efficient',
                    xp: 50,
                    timeLimit: 120,
                    content: {
                        items: ['LED Bulbs', 'Insulation', 'Smart Thermostat', 'Energy Star Appliances'],
                        efficiencyBonus: [20, 30, 25, 40]
                    }
                },
                {
                    id: 'energy-3',
                    title: 'Wind Farm Strategy',
                    type: 'strategy',
                    difficulty: 'Hard',
                    description: 'Plan optimal wind turbine placement',
                    xp: 120,
                    content: {
                        mapSize: { width: 10, height: 10 },
                        obstacles: ['Mountain', 'Building', 'Water'],
                        goal: 'Maximize energy output'
                    }
                },
                {
                    id: 'energy-4',
                    title: 'Energy Word Scramble',
                    type: 'word',
                    difficulty: 'Easy',
                    description: 'Unscramble renewable energy terms',
                    xp: 30,
                    timeLimit: 180,
                    content: {
                        words: [
                            { scrambled: 'RLAOS', answer: 'SOLAR' },
                            { scrambled: 'DNWI', answer: 'WIND' },
                            { scrambled: 'DROHY', answer: 'HYDRO' },
                            { scrambled: 'METOALGREH', answer: 'GEOTHERMAL' }
                        ]
                    }
                }
            ],
            waste: [
                {
                    id: 'waste-1',
                    title: 'Recycling Plant Manager',
                    type: 'management',
                    difficulty: 'Hard',
                    description: 'Manage a recycling facility efficiently',
                    xp: 100,
                    content: {
                        materials: ['Plastic', 'Glass', 'Paper', 'Metal'],
                        processes: ['Collection', 'Sorting', 'Processing', 'Manufacturing'],
                        efficiency: 0.75,
                        goal: 'Process maximum materials with minimum waste'
                    }
                },
                {
                    id: 'waste-2',
                    title: 'Composting Timeline',
                    type: 'timeline',
                    difficulty: 'Medium',
                    description: 'Arrange composting process in correct order',
                    xp: 60,
                    content: {
                        stages: [
                            'Add brown materials',
                            'Add green materials', 
                            'Mix thoroughly',
                            'Monitor temperature',
                            'Turn compost',
                            'Harvest finished compost'
                        ],
                        timeframes: ['Week 1', 'Week 1', 'Week 2', 'Week 4', 'Week 8', 'Week 12']
                    }
                }
            ],
            transport: [
                {
                    id: 'transport-1',
                    title: 'Carbon Footprint Calculator',
                    type: 'calculator',
                    difficulty: 'Medium',
                    description: 'Calculate and compare transport emissions',
                    xp: 70,
                    content: {
                        modes: [
                            { name: 'Walking', co2PerKm: 0 },
                            { name: 'Cycling', co2PerKm: 0 },
                            { name: 'Bus', co2PerKm: 0.05 },
                            { name: 'Car', co2PerKm: 0.2 },
                            { name: 'Flight', co2PerKm: 0.25 }
                        ]
                    }
                }
            ],
            biodiversity: [
                {
                    id: 'bio-1',
                    title: 'Ecosystem Builder',
                    type: 'ecosystem',
                    difficulty: 'Hard',
                    description: 'Create a balanced ecosystem',
                    xp: 120,
                    content: {
                        species: ['Producers', 'Primary Consumers', 'Secondary Consumers', 'Decomposers'],
                        balance: { producers: 4, primary: 2, secondary: 1, decomposers: 1 }
                    }
                },
                {
                    id: 'bio-2',
                    title: 'Animal Habitat Match',
                    type: 'matching',
                    difficulty: 'Easy',
                    description: 'Match animals with their habitats',
                    xp: 40,
                    content: {
                        animals: ['Polar Bear', 'Parrot', 'Camel', 'Dolphin'],
                        habitats: ['Arctic', 'Rainforest', 'Desert', 'Ocean']
                    }
                },
                {
                    id: 'bio-3',
                    title: 'Plant Growth Simulator',
                    type: 'growth',
                    difficulty: 'Medium',
                    description: 'Grow plants with optimal conditions',
                    xp: 80,
                    content: {
                        factors: ['Light', 'Water', 'Temperature', 'Nutrients'],
                        stages: ['Seed', 'Sprout', 'Seedling', 'Adult', 'Flowering'],
                        optimal: { light: 70, water: 60, temperature: 25, nutrients: 50 }
                    }
                }
            ],
            climate: [
                {
                    id: 'climate-1',
                    title: 'Greenhouse Effect Demo',
                    type: 'simulation',
                    difficulty: 'Hard',
                    description: 'Understand greenhouse effect through simulation',
                    xp: 100,
                    content: {
                        gases: ['CO2', 'CH4', 'N2O', 'H2O'],
                        effects: [1, 25, 298, 0.1],
                        scenario: 'Adjust gas concentrations and observe temperature changes'
                    }
                }
            ],
            food: [
                {
                    id: 'food-1',
                    title: 'Sustainable Menu Planner',
                    type: 'planning',
                    difficulty: 'Medium',
                    description: 'Plan a week of sustainable meals',
                    xp: 80,
                    content: {
                        foods: [
                            { name: 'Lentils', co2: 0.9, season: 'All', local: true },
                            { name: 'Beef', co2: 60, season: 'All', local: false },
                            { name: 'Tomatoes', co2: 2.1, season: 'Summer', local: true }
                        ],
                        constraints: { maxCO2: 20, localPercentage: 0.6 }
                    }
                }
            ],
            pollution: [
                {
                    id: 'pollution-1',
                    title: 'Air Quality Monitor',
                    type: 'monitoring',
                    difficulty: 'Hard',
                    description: 'Monitor and analyze air quality data',
                    xp: 90,
                    content: {
                        pollutants: ['PM2.5', 'PM10', 'NO2', 'SO2', 'O3', 'CO'],
                        levels: [25, 50, 40, 20, 120, 9],
                        standards: [25, 50, 40, 20, 100, 10],
                        goal: 'Identify pollution sources and solutions'
                    }
                }
            ]
        };

        // Initialize game
        function initGame() {
            updatePlayerStats();
            loadAchievements();
            loadLeaderboard();
            startDailyTimer();
            checkDailyReset();
        }

        function checkDailyReset() {
            const today = new Date().toDateString();
            if (gameState.lastPlayDate !== today) {
                gameState.todayScore = 0;
                gameState.lastPlayDate = today;
                saveGameState();
            }
        }

        function startDailyTimer() {
            setInterval(updateDailyTimer, 1000);
        }

        function updateDailyTimer() {
            const now = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const diff = tomorrow - now;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('dailyTimer').textContent = 
                `Resets in: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updatePlayerStats() {
            document.getElementById('playerLevel').textContent = `Level ${gameState.playerLevel}`;
            document.getElementById('playerXP').textContent = `${gameState.playerXP} XP`;
            document.getElementById('playerBadges').textContent = `${gameState.badges.length} üèÜ`;
            document.getElementById('playerStreak').textContent = `${gameState.currentStreak} üî•`;
            document.getElementById('todayScore').textContent = `${gameState.todayScore} ‚≠ê`;
            
            const xpForNextLevel = gameState.playerLevel * 100;
            const currentLevelXP = gameState.playerXP % 100;
            const xpProgress = (currentLevelXP / 100) * 100;
            document.getElementById('xpProgress').style.width = `${xpProgress}%`;
            document.getElementById('xpText').textContent = `${currentLevelXP}/100 XP`;
        }

        // Show challenges for a category
        function showChallenges(category) {
            const challengeArea = document.getElementById('challengeArea');
            const challengeContent = document.getElementById('challengeContent');
            
            let html = `
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-[#158a8e]">
                        ${getCategoryIcon(category)} ${category.charAt(0).toUpperCase() + category.slice(1)} Challenges
                    </h2>
                    <div class="filter-buttons flex gap-2">
                        <button onclick="filterChallenges('${category}', 'all')" class="px-3 py-1 rounded bg-gray-200 text-sm">All</button>
                        <button onclick="filterChallenges('${category}', 'Easy')" class="px-3 py-1 rounded bg-green-200 text-sm">Easy</button>
                        <button onclick="filterChallenges('${category}', 'Medium')" class="px-3 py-1 rounded bg-yellow-200 text-sm">Medium</button>
                        <button onclick="filterChallenges('${category}', 'Hard')" class="px-3 py-1 rounded bg-red-200 text-sm">Hard</button>
                    </div>
                </div>
                <div class="grid gap-6" id="challengesList">
            `;
            
            const categoryData = challenges[category] || [];
            categoryData.forEach(challenge => {
                const isCompleted = gameState.completedChallenges.includes(challenge.id);
                const difficultyColor = getDifficultyColor(challenge.difficulty);
                html += `
                    <div class="challenge-item border-2 border-gray-200 rounded-lg p-6 ${isCompleted ? 'bg-green-50 border-green-300' : 'bg-gray-50'} cursor-pointer hover:border-[#20c4b6] transition-all" onclick="startChallenge('${challenge.id}', '${category}')">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h3 class="font-bold text-lg text-[#158a8e]">${challenge.title}</h3>
                                    <span class="px-2 py-1 rounded text-xs font-semibold ${difficultyColor}">${challenge.difficulty}</span>
                                    ${challenge.timeLimit ? <span class="text-xs text-gray-500">‚è± ${Math.floor(challenge.timeLimit/60)}:${(challenge.timeLimit%60).toString().padStart(2,'0')}</span> : ''}
                                </div>
                                <p class="text-gray-600 mb-3">${challenge.description}</p>
                                <div class="flex items-center gap-4">
                                    <span class="bg-[#20c4b6] text-white px-3 py-1 rounded-full text-sm font-semibold">+${challenge.xp} XP</span>
                                    <span class="text-sm text-gray-500 capitalize">${challenge.type}</span>
                                    ${isCompleted ? '<span class="text-green-600 text-sm font-semibold">‚úÖ Completed</span>' : ''}
                                </div>
                            </div>
                            <div class="text-3xl ml-4">
                                ${getTypeIcon(challenge.type)}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            challengeContent.innerHTML = html;
            challengeArea.classList.remove('hidden');
            challengeArea.scrollIntoView({ behavior: 'smooth' });
        }

        // Filter challenges function
        function filterChallenges(category, difficulty) {
            // This function would filter challenges by difficulty
            // For now, just show all challenges
            showChallenges(category);
        }

        // Start a specific challenge
        function startChallenge(challengeId, category) {
            const challenge = challenges[category].find(c => c.id === challengeId);
            if (!challenge) return;

            currentChallenge = challenge;
            
            switch (challenge.type) {
                case 'drag-drop':
                    renderDragDropChallenge(challenge);
                    break;
                case 'memory':
                    renderMemoryChallenge(challenge);
                    break;
                case 'quiz':
                    renderQuizChallenge(challenge);
                    break;
                case 'calculator':
                    renderCalculatorChallenge(challenge);
                    break;
                case 'puzzle':
                    renderPuzzleChallenge(challenge);
                    break;
                case 'word':
                    renderWordChallenge(challenge);
                    break;
                case 'ecosystem':
                    renderEcosystemChallenge(challenge);
                    break;
                case 'growth':
                    renderGrowthChallenge(challenge);
                    break;
                case 'matching':
                    renderMatchingChallenge(challenge);
                    break;
                case 'simulation':
                    renderSimulationChallenge(challenge);
                    break;
                case 'builder':
                    renderBuilderChallenge(challenge);
                    break;
                case 'race':
                    renderRaceChallenge(challenge);
                    break;
                case 'strategy':
                    renderStrategyChallenge(challenge);
                    break;
                case 'lab':
                    renderLabChallenge(challenge);
                    break;
                case 'timeline':
                    renderTimelineChallenge(challenge);
                    break;
                case 'management':
                    renderManagementChallenge(challenge);
                    break;
                case 'planning':
                    renderPlanningChallenge(challenge);
                    break;
                case 'monitoring':
                    renderMonitoringChallenge(challenge);
                    break;
                default:
                    renderDefaultChallenge(challenge);
                    break;
            }
        }

        // Render default challenge for missing types
        function renderDefaultChallenge(challenge) {
            const challengeContent = document.getElementById('challengeContent');
            
            let html = `
                <div class="challenge-header mb-6">
                    <h2 class="text-2xl font-bold text-[#158a8e] mb-2">${challenge.title}</h2>
                    <p class="text-gray-600">${challenge.description}</p>
                </div>
                
                <div class="game-area bg-gray-50 p-6 mb-6 text-center">
                    <div class="text-6xl mb-4">${getTypeIcon(challenge.type)}</div>
                    <h3 class="text-xl font-bold mb-4">Interactive Challenge</h3>
                    <p class="text-gray-600 mb-6">This is a ${challenge.type} challenge. Click below to complete it!</p>
                    <button onclick="completeChallenge(currentChallenge)" class="bg-[#20c4b6] text-white px-6 py-3 rounded-lg font-semibold hover:bg-[#1ba89e] transition-colors">
                        Complete Challenge
                    </button>
                </div>
            `;
            
            challengeContent.innerHTML = html;
        }

        // Render drag and drop challenge
        function renderDragDropChallenge(challenge) {
            const challengeContent = document.getElementById('challengeContent');
            if (challenge.timeLimit) startTimer(challenge.timeLimit);
            
            let html = `
                <div class="challenge-header mb-6">
                    <h2 class="text-2xl font-bold text-[#158a8e] mb-2">${challenge.title}</h2>
                    <p class="text-gray-600">${challenge.description}</p>
                </div>
                
                <div class="game-area bg-gray-50 p-6 mb-6">
                    <div class="grid md:grid-cols-3 gap-6 mb-6">
            `;
            
            challenge.content.categories.forEach(category => {
                html += `
                    <div class="drop-zone bg-white p-4 rounded-lg min-h-32" data-category="${category}">
                        <h3 class="font-bold text-center mb-3 text-[#158a8e]">${category}</h3>
                        <div class="drop-area min-h-20"></div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    <div class="draggable-items">
                        <h3 class="font-bold mb-3 text-[#158a8e]">Drag items to the correct category:</h3>
                        <div class="flex flex-wrap gap-3">
            `;
            
            challenge.content.items.forEach((item, index) => {
                html += `
                    <div class="draggable bg-[#20c4b6] text-white px-4 py-2 rounded-lg" draggable="true" data-item="${item}">
                        ${item}
                    </div>
                `;
            });
            
            html += `
                        </div>
                    </div>
                </div>
                
                <div class="text-center">
                    <button onclick="checkDragDropAnswer()" class="bg-[#20c4b6] text-white px-6 py-3 rounded-lg font-semibold hover:bg-[#1ba89e] transition-colors">
                        Check Answer
                    </button>
                </div>
            `;
            
            challengeContent.innerHTML = html;
            setTimeout(() => setupDragAndDrop(), 100);
        }

        // Setup drag and drop functionality
        function setupDragAndDrop() {
            const draggables = document.querySelectorAll('.draggable');
            const dropZones = document.querySelectorAll('.drop-zone');
            
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', draggable.dataset.item);
                });
            });
            
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('active');
                });
                
                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('active');
                });
                
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('active');
                    
                    const item = e.dataTransfer.getData('text/plain');
                    const dropArea = zone.querySelector('.drop-area');
                    
                    const originalElement = document.querySelector(`[data-item="${item}"]`);
                    if (originalElement) {
                        originalElement.remove();
                    }
                    
                    const newElement = document.createElement('div');
                    newElement.className = 'bg-gray-200 text-gray-800 px-3 py-1 rounded mb-2';
                    newElement.textContent = item;
                    newElement.dataset.item = item;
                    dropArea.appendChild(newElement);
                });
            });
        }

        function checkDragDropAnswer() {
            const dropZones = document.querySelectorAll('.drop-zone');
            let playerAnswers = {};
            
            dropZones.forEach(zone => {
                const category = zone.dataset.category;
                const items = Array.from(zone.querySelectorAll('[data-item]')).map(el => el.dataset.item);
                playerAnswers[category] = items;
            });
            
            const correct = currentChallenge.content.correct;
            let allCorrect = true;
            
            for (const cat in correct) {
                const correctItems = correct[cat];
                const playerItems = playerAnswers[cat] || [];
                
                if (correctItems.length !== playerItems.length) {
                    allCorrect = false;
                    break;
                }
                
                for (const item of correctItems) {
                    if (!playerItems.includes(item)) {
                        allCorrect = false;
                        break;
                    }
                }
            }
            
            if (allCorrect) {
                completeChallenge(currentChallenge);
            } else {
                alert('Not quite right! Try again.');
            }
        }

        // Render memory challenge
        function renderMemoryChallenge(challenge) {
            const challengeContent = document.getElementById('challengeContent');
            if (challenge.timeLimit) startTimer(challenge.timeLimit);
            
            const pairs = challenge.content.pairs;
            const cards = [];
            pairs.forEach(pair => {
                cards.push({ id: pair.id, content: pair.text, type: 'question' });
                cards.push({ id: pair.id, content: pair.match, type: 'answer' });
            });
            
            // Shuffle cards
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
            
            let html = `
                <div class="challenge-header mb-6">
                    <h2 class="text-2xl font-bold text-[#158a8e] mb-2">${challenge.title}</h2>
                    <p class="text-gray-600">${challenge.description}</p>
                    <div class="mt-4 flex items-center gap-4">
                        <div class="text-sm">Matches Found: <span id="matchCount" class="font-bold text-[#20c4b6]">0</span>/${pairs.length}</div>
                        <div class="text-sm">Attempts: <span id="attemptCount" class="font-bold text-[#fd7e25]">0</span></div>
                    </div>
                </div>
                
                <div class="game-area bg-gray-50 p-6 mb-6">
                    <div class="memory-grid grid grid-cols-4 gap-4 max-w-lg mx-auto">
            `;
            
            cards.forEach((card, index) => {
                html += `
                    <div class="memory-card" data-id="${card.id}" data-content="${card.content}" onclick="flipCard(this)">
                        <div class="memory-card-face memory-card-front">‚ùì</div>
                        <div class="memory-card-face memory-card-back">${card.content}</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            challengeContent.innerHTML = html;
            
            window.memoryGame = {
                flippedCards: [],
                matchedPairs: 0,
                attempts: 0,
                totalPairs: pairs.length
            };
        }

        function flipCard(cardElement) {
            if (cardElement.classList.contains('flipped') || window.memoryGame.flippedCards.length >= 2) {
                return;
            }
            
            cardElement.classList.add('flipped');
            window.memoryGame.flippedCards.push(cardElement);
            
            if (window.memoryGame.flippedCards.length === 2) {
                window.memoryGame.attempts++;
                document.getElementById('attemptCount').textContent = window.memoryGame.attempts;
                setTimeout(() => checkMemoryMatch(), 1000);
            }
        }

        function checkMemoryMatch() {
            const [card1, card2] = window.memoryGame.flippedCards;
            const id1 = card1.dataset.id;
            const id2 = card2.dataset.id;
            
            if (id1 === id2) {
                window.memoryGame.matchedPairs++;
                document.getElementById('matchCount').textContent = window.memoryGame.matchedPairs;
                
                card1.style.opacity = '0.6';
                card2.style.opacity = '0.6';
                
                if (window.memoryGame.matchedPairs === window.memoryGame.totalPairs) {
                    setTimeout(() => {
                        stopTimer();
                        completeChallenge(currentChallenge);
                    }, 500);
                }
            } else {
                card1.classList.remove('flipped');
                card2.classList.remove('flipped');
            }
            
            window.memoryGame.flippedCards = [];
        }

        // Render quiz challenge
        function renderQuizChallenge(challenge) {
            const challengeContent = document.getElementById('challengeContent');
            
            let html = `
                <div class="challenge-header mb-6">
                    <h2 class="text-2xl font-bold text-[#158a8e] mb-2">${challenge.title}</h2>
                    <p class="text-gray-600">${challenge.description}</p>
                </div>
                
                <div id="quizContainer">
            `;
            
            challenge.content.questions.forEach((q, qIndex) => {
                html += `
                    <div class="question-card bg-white p-6 rounded-lg shadow mb-6" data-question="${qIndex}">
                        <h3 class="font-bold text-lg mb-4 text-[#158a8e]">${q.question}</h3>
                        <div class="options grid gap-3">
                `;
                
                q.options.forEach((option, oIndex) => {
                    html += `
                        <label class="option-label cursor-pointer p-3 border-2 border-gray-200 rounded-lg hover:border-[#20c4b6] transition-colors">
                            <input type="radio" name="question_${qIndex}" value="${oIndex}" class="mr-3">
                            ${option}
                        </label>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            html += `
                </div>
                <div class="text-center">
                    <button onclick="checkQuizAnswer()" class="bg-[#20c4b6] text-white px-6 py-3 rounded-lg font-semibold hover:bg-[#1ba89e] transition-colors">
                        Submit Quiz
                    </button>
                </div>
            `;
            
            challengeContent.innerHTML = html;
        }

        function checkQuizAnswer() {
            let correctCount = 0;
            const questions = currentChallenge.content.questions;
            
            questions.forEach((q, index) => {
                const selectedAnswer = document.querySelector(`input[name="question_${index}"]:checked`);
                if (selectedAnswer && parseInt(selectedAnswer.value) === q.correct) {
                    correctCount++;
                }
            });
            
            const percentage = (correctCount / questions.length) * 100;
            
            if (percentage >= 70) {
                completeChallenge(currentChallenge);
            } else {
                alert(`You scored ${percentage.toFixed(0)}%. You need 70% or higher to pass.`);
            }
        }

        // Render calculator challenge
        function renderCalculatorChallenge(challenge) {
            const challengeContent = document.getElementById('challengeContent');
            
            let html = `
                <div class="challenge-header mb-6">
                    <h2 class="text-2xl font-bold text-[#158a8e] mb-2">${challenge.title}</h2>
                    <p class="text-gray-600">${challenge.description}</p>
                </div>
                
                <div class="game-area bg-gray-50 p-6 mb-6">
                    <div class="calculator-content">
            `;
            
            if (challenge.content.products) {
                html += `
                    <h3 class="font-bold mb-4">Select products to calculate total virtual water:</h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                `;
                
                challenge.content.products.forEach((product, index) => {
                    html += `
                        <label class="flex items-center p-3 border rounded-lg hover:bg-white cursor-pointer">
                            <input type="checkbox" class="mr-3 calc-item" data-water="${product.water}" onchange="updateCalculation()">
                            <div>
                                <div class="font-semibold">${product.name}</div>
                                <div class="text-sm text-gray-600">${product.water}L virtual water</div>
                            </div>
                        </label>
                    `;
                });
                
                html += `
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-[#20c4b6]">Total: <span id="totalWater">0</span>L</div>
                        <p class="text-sm text-gray-600 mt-2">This equals <span id="bottlesEquivalent">0</span> bottles of water!</p>
                    </div>
                `;
            } else if (challenge.content.modes) {
                html += `
                    <h3 class="font-bold mb-4">Calculate carbon footprint for a 10km journey:</h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                `;
                
                challenge.content.modes.forEach((mode, index) => {
                    html += `
                        <div class="p-3 border rounded-lg bg-white">
                            <div class="font-semibold">${mode.name}</div>
                            <div class="text-sm text-gray-600">${mode.co2PerKm}kg CO2/km</div>
                            <div class="text-lg font-bold text-[#20c4b6]">Total: ${(mode.co2PerKm * 10).toFixed(2)}kg CO2</div>
                        </div>
                    `;
                });
                
                html += `
                    </div>
                    <div class="text-center bg-white p-4 rounded-lg">
                        <h4 class="font-bold mb-2">Winner: üå± Walking & Cycling (0kg CO2)</h4>
                        <p class="text-sm text-gray-600">Choose eco-friendly transport to reduce your carbon footprint!</p>
                    </div>
                `;
            }
            
            html += `
                    </div>
                </div>
                
                <div class="text-center">
                    <button onclick="completeChallenge(currentChallenge)" class="bg-[#20c4b6] text-white px-6 py-3 rounded-lg font-semibold hover:bg-[#1ba89e] transition-colors">
                        Complete Challenge
                    </button>
                </div>
            `;
            
            challengeContent.innerHTML = html;
        }

        function updateCalculation() {
            const checkedItems = document.querySelectorAll('.calc-item:checked');
            let total = 0;
            checkedItems.forEach(item => {
                total += parseInt(item.dataset.water);
            });
            
            document.getElementById('totalWater').textContent = total;
            document.getElementById('bottlesEquivalent').textContent = Math.round(total / 0.5);
        }

        // Add all remaining render functions (simplified for space)
        function renderPuzzleChallenge(challenge) { renderDefaultChallenge(challenge); }
        function renderWordChallenge(challenge) { renderDefaultChallenge(challenge); }
        function renderEcosystemChallenge(challenge) { renderDefaultChallenge(challenge); }
        function renderGrowthChallenge(challenge) { renderDefaultChallenge(challenge); }
        function renderMatchingChallenge(challenge) { renderDefaultChallenge(challenge); }
        function renderSimulationChallenge(challenge) { renderDefaultChallenge(challenge); }
        function renderBuilderChallenge(challenge) { renderDefaultChallenge(challenge); }
        function renderRaceChallenge(challenge) { renderDefaultChallenge(challenge); }
        function renderStrategyChallenge(challenge) { renderDefaultChallenge(challenge); }
        function renderLabChallenge(challenge) { renderDefaultChallenge(challenge); }
        function renderTimelineChallenge(challenge) { renderDefaultChallenge(challenge); }
        function renderManagementChallenge(challenge) { renderDefaultChallenge(challenge); }
        function renderPlanningChallenge(challenge) { renderDefaultChallenge(challenge); }
        function renderMonitoringChallenge(challenge) { renderDefaultChallenge(challenge); }

        // Timer functions
        function startTimer(seconds) {
            if (!seconds) return;
            
            document.getElementById('timerModal').classList.remove('hidden');
            
            window.gameTimer = {
                remaining: seconds,
                interval: setInterval(() => {
                    window.gameTimer.remaining--;
                    const minutes = Math.floor(window.gameTimer.remaining / 60);
                    const secs = window.gameTimer.remaining % 60;
                    document.getElementById('gameTimer').textContent = 
                        document.getElementById('gameTimer').textContent = `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                    
                    if (window.gameTimer.remaining <= 0) {
                        stopTimer();
                        alert('Time\'s up! Try again to improve your time.');
                    }
                }, 1000)
            };
        }

        function stopTimer() {
            if (window.gameTimer) {
                clearInterval(window.gameTimer.interval);
                document.getElementById('timerModal').classList.add('hidden');
                window.gameTimer = null;
            }
        }

        // Complete challenge
        function completeChallenge(challenge) {
            if (gameState.completedChallenges.includes(challenge.id)) {
                alert('Challenge already completed!');
                return;
            }
            
            gameState.playerXP += challenge.xp;
            gameState.completedChallenges.push(challenge.id);
            gameState.currentStreak++;
            gameState.todayScore++;
            
            const newLevel = Math.floor(gameState.playerXP / 100) + 1;
            let leveledUp = false;
            if (newLevel > gameState.playerLevel) {
                gameState.playerLevel = newLevel;
                leveledUp = true;
            }
            
            checkForBadges();
            saveGameState();
            showCompletionModal(challenge, leveledUp);
            updatePlayerStats();
        }

        // Check for new badges
        function checkForBadges() {
            const badgeConditions = [
                { id: 'first-challenge', name: 'First Steps', condition: () => gameState.completedChallenges.length >= 1 },
                { id: 'water-expert', name: 'Water Expert', condition: () => gameState.completedChallenges.filter(id => id.startsWith('water')).length >= 3 },
                { id: 'energy-saver', name: 'Energy Saver', condition: () => gameState.completedChallenges.filter(id => id.startsWith('energy')).length >= 2 },
                { id: 'eco-champion', name: 'Eco Champion', condition: () => gameState.completedChallenges.length >= 10 },
                { id: 'streak-master', name: 'Streak Master', condition: () => gameState.currentStreak >= 5 }
            ];
            
            badgeConditions.forEach(badge => {
                if (!gameState.badges.includes(badge.id) && badge.condition()) {
                    gameState.badges.push(badge.id);
                }
            });
        }

        // Show completion modal
        function showCompletionModal(challenge, leveledUp) {
            const modal = document.getElementById('completionModal');
            const rewardText = document.getElementById('rewardText');
            const streakBonus = document.getElementById('streakBonus');
            
            createParticles();
            
            let text = `You earned ${challenge.xp} XP!`;
            if (leveledUp) {
                text += ` üéâ Level Up! You're now Level ${gameState.playerLevel}!`;
            }
            
            if (window.gameTimer && window.gameTimer.remaining > 0) {
                const timeBonus = Math.floor(window.gameTimer.remaining / 10);
                text += ` ‚ö° Time Bonus: +${timeBonus} XP!`;
                gameState.playerXP += timeBonus;
            }
            
            rewardText.textContent = text;
            
            if (gameState.currentStreak > 1) {
                streakBonus.innerHTML = `<div class="text-sm text-[#fd7e25]">üî• ${gameState.currentStreak} Challenge Streak!</div>`;
            }
            
            modal.classList.remove('hidden');
        }

        function createParticles() {
            const particles = document.getElementById('particles');
            particles.innerHTML = '';
            
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 2 + 's';
                particles.appendChild(particle);
            }
        }

        function closeModal() {
            document.getElementById('completionModal').classList.add('hidden');
        }

        function saveGameState() {
            localStorage.setItem('ecoGameState', JSON.stringify(gameState));
        }

        function loadLeaderboard() {
            const leaderboard = [
                { name: 'EcoWarrior', score: 2500, level: 12 },
                { name: 'GreenGamer', score: 2200, level: 11 },
                { name: 'You', score: gameState.playerXP, level: gameState.playerLevel },
                { name: 'NatureLover', score: 1800, level: 9 },
                { name: 'ClimateHero', score: 1500, level: 8 }
            ];
            
            leaderboard.sort((a, b) => b.score - a.score);
            
            const leaderboardElement = document.getElementById('leaderboard');
            let html = '';
            
            leaderboard.slice(0, 5).forEach((player, index) => {
                const medal = index < 3 ? ['ü•á', 'ü•à', 'ü•â'][index] : `#${index + 1}`;
                const isPlayer = player.name === 'You';
                html += `
                    <div class="flex items-center justify-between p-3 ${isPlayer ? 'bg-[#e1f7ef] border border-[#20c4b6]' : 'bg-gray-50'} rounded-lg">
                        <div class="flex items-center gap-3">
                            <span class="text-lg">${medal}</span>
                            <span class="font-semibold ${isPlayer ? 'text-[#20c4b6]' : ''}">${player.name}</span>
                            <span class="text-sm text-gray-500">Level ${player.level}</span>
                        </div>
                        <span class="font-bold text-[#fd7e25]">${player.score} XP</span>
                    </div>
                `;
            ¬†});
            
            leaderboardElement.innerHTML = html;
        }

        function loadAchievements() {
            const achievementsGrid = document.getElementById('achievementsGrid');
            const allBadges = [
                { id: 'first-challenge', name: 'First Steps', icon: 'üå±', description: 'Complete your first challenge' },
                { id: 'water-expert', name: 'Water Expert', icon: 'üíß', description: 'Complete 3 water challenges' },
                { id: 'energy-saver', name: 'Energy Saver', icon: '‚ö°', description: 'Complete 2 energy challenges' },
                { id: 'eco-champion', name: 'Eco Champion', icon: 'üèÜ', description: 'Complete 10 challenges' },
                { id: 'streak-master', name: 'Streak Master', icon: 'üî•', description: 'Complete 5 challenges in a row' },
                { id: 'bio-explorer', name: 'Bio Explorer', icon: 'üåø', description: 'Complete biodiversity challenges' }
            ];
            
            let html = '';
            allBadges.forEach(badge => {
                const earned = gameState.badges.includes(badge.id);
                html += `
                    <div class="text-center p-3 ${earned ? 'bg-gradient-to-br from-yellow-100 to-yellow-200 border-2 border-yellow-400' : 'bg-gray-50 border border-gray-200'} rounded-lg transition-all hover:scale-105" title="${badge.description}">
                        <div class="text-3xl mb-2 ${earned ? 'badge' : 'grayscale opacity-30'}">${badge.icon}</div>
                        <div class="font-semibold text-xs ${earned ? 'text-yellow-700' : 'text-gray-400'}">${badge.name}</div>
                    </div>
                `;
            });
            
            achievementsGrid.innerHTML = html;
        }

        // Utility functions
        function getDifficultyColor(difficulty) {
            switch (difficulty) {
                case 'Easy': return 'bg-green-100 text-green-800';
                case 'Medium': return 'bg-yellow-100 text-yellow-800';
                case 'Hard': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getTypeIcon(type) {
            const icons = {
                'drag-drop': 'üéØ',
                'memory': 'üß†',
                'quiz': '‚ùì',
                'calculator': 'üßÆ',
                'simulation': '‚öó',
                'puzzle': 'üß©',
                'builder': 'üèó',
                'race': 'üèÉ',
                'strategy': '‚ôü',
                'word': 'üìù',
                'ecosystem': 'üåç',
                'growth': 'üå±',
                'management': 'üìä',
                'timeline': 'üìÖ',
                'matching': 'üîó',
                'lab': 'üî¨',
                'planning': 'üìã',
                'monitoring': 'üì°'
            };
            return icons[type] || 'üéÆ';
        }

        function getCategoryIcon(category) {
            const icons = {
                water: 'üíß',
                energy: '‚ö°',
                waste: '‚ôª',
                transport: 'üö≤',
                biodiversity: 'üåø',
                climate: 'üå°',
                food: 'ü•¨',
                pollution: 'üè≠'
            };
            return icons[category] || 'üåç';
        }

        // Initialize the game when page loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body>
</html>
