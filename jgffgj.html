<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoSaver - Interactive Challenges</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f4fff8 0%, #e1f7ef 100%);
        }
        .challenge-card {
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .challenge-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 35px rgba(32, 196, 182, 0.2);
        }
        .challenge-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        .challenge-card:hover::before {
            left: 100%;
        }
        .progress-bar {
            background: linear-gradient(90deg, #20c4b6 0%, #fd7e25 100%);
            border-radius: 10px;
            height: 8px;
            transition: width 0.5s ease;
        }
        .badge {
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        .game-area {
            min-height: 400px;
            border: 3px dashed #20c4b6;
            border-radius: 15px;
            position: relative;
        }
        .draggable {
            cursor: grab;
            transition: all 0.2s;
            user-select: none;
        }
        .draggable:hover {
            transform: scale(1.1) rotate(2deg);
            z-index: 10;
        }
        .draggable:active {
            cursor: grabbing;
            transform: scale(1.15) rotate(5deg);
        }
        .drop-zone {
            border: 2px dashed #ccc;
            transition: all 0.3s;
            min-height: 80px;
        }
        .drop-zone.active {
            border-color: #20c4b6;
            background: rgba(32, 196, 182, 0.1);
            transform: scale(1.05);
        }
        .memory-card {
            width: 80px;
            height: 80px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .memory-card.flipped {
            transform: rotateY(180deg);
        }
        .memory-card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 24px;
        }
        .memory-card-back {
            background: #20c4b6;
            color: white;
            transform: rotateY(180deg);
        }
        .memory-card-front {
            background: #e1f7ef;
        }
        .timer {
            font-family: 'Courier New', monospace;
            font-size: 2rem;
            font-weight: bold;
            color: #fd7e25;
        }
        .plant-stage {
            transition: all 0.5s ease;
            transform-origin: bottom center;
        }
        .plant-stage.grow {
            transform: scale(1.2);
        }
        .ecosystem-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 2px;
            width: 300px;
            height: 300px;
        }
        .ecosystem-cell {
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.2s;
        }
        .ecosystem-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        .floating-score {
            position: absolute;
            font-weight: bold;
            font-size: 1.2rem;
            color: #20c4b6;
            animation: floatUp 1s ease-out;
            pointer-events: none;
        }
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #20c4b6;
            border-radius: 50%;
            animation: particle 2s ease-out;
        }
        @keyframes particle {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0); opacity: 0; }
        }
        .challenge-difficulty {
            background: linear-gradient(45deg, #20c4b6, #fd7e25);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .daily-challenge {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(255, 107, 107, 0.3); }
            to { box-shadow: 0 0 30px rgba(254, 202, 87, 0.5); }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header with enhanced stats -->
    <header class="bg-white shadow-sm border-b-2 border-[#20c4b6] sticky top-0 z-40">
        <div class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="index.html" class="text-[#20c4b6] hover:text-[#fd7e25] font-semibold">‚Üê Back to Dashboard</a>
                <h1 class="text-2xl font-bold text-[#158a8e]">üéÆ Interactive Challenges</h1>
            </div>
            <div class="flex items-center gap-6">
                <!-- Enhanced Player Stats -->
                <div class="flex items-center gap-4">
                    <div class="text-center">
                        <div class="text-lg font-bold challenge-difficulty" id="playerLevel">Level 1</div>
                        <div class="text-xs text-gray-500">EcoWarrior</div>
                    </div>
                    <div class="text-center">
                        <div class="text-lg font-bold text-[#20c4b6]" id="playerXP">0 XP</div>
                        <div class="text-xs text-gray-500">Experience</div>
                    </div>
                    <div class="text-center">
                        <div class="text-lg font-bold text-[#fd7e25]" id="playerBadges">0 üèÜ</div>
                        <div class="text-xs text-gray-500">Badges</div>
                    </div>
                    <div class="text-center">
                        <div class="text-lg font-bold text-purple-600" id="playerStreak">0 üî•</div>
                        <div class="text-xs text-gray-500">Streak</div>
                    </div>
                    <div class="text-center">
                        <div class="text-lg font-bold text-green-600" id="todayScore">0 ‚≠ê</div>
                        <div class="text-xs text-gray-500">Today</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Enhanced XP Progress Bar with segments -->
        <div class="w-full bg-gray-200 h-3 relative">
            <div class="progress-bar w-0 h-full" id="xpProgress"></div>
            <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white" id="xpText">0/100 XP</div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <!-- Daily Challenge Banner -->
        <div class="daily-challenge rounded-xl p-6 mb-8 text-white text-center">
            <h2 class="text-2xl font-bold mb-2">üåü Daily Challenge</h2>
            <p class="mb-4" id="dailyChallengeText">Complete 3 challenges to earn bonus XP!</p>
            <div class="text-sm opacity-90" id="dailyTimer">Resets in: 23:45:12</div>
        </div>

        <!-- Enhanced Challenge Categories -->
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-[#20c4b6]" onclick="showChallenges('water')">
                <div class="text-4xl mb-3">üíß</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Water Challenges</h3>
                <p class="text-sm text-gray-600">Conservation & Management</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-[#20c4b6] font-semibold">12 Challenges</span>
                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Easy-Hard</span>
                </div>
            </div>
            
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-[#fd7e25]" onclick="showChallenges('energy')">
                <div class="text-4xl mb-3">‚ö°</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Energy Challenges</h3>
                <p class="text-sm text-gray-600">Renewable & Efficiency</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-[#fd7e25] font-semibold">10 Challenges</span>
                    <span class="text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded">Medium</span>
                </div>
            </div>
            
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500" onclick="showChallenges('waste')">
                <div class="text-4xl mb-3">‚ôª</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Waste Management</h3>
                <p class="text-sm text-gray-600">Reduce, Reuse, Recycle</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-green-600 font-semibold">8 Challenges</span>
                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Easy</span>
                </div>
            </div>
            
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-purple-500" onclick="showChallenges('transport')">
                <div class="text-4xl mb-3">üö≤</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Green Transport</h3>
                <p class="text-sm text-gray-600">Sustainable Mobility</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-purple-600 font-semibold">6 Challenges</span>
                    <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">Medium</span>
                </div>
            </div>
            
            <!-- New Categories -->
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-pink-500" onclick="showChallenges('biodiversity')">
                <div class="text-4xl mb-3">üåø</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Biodiversity</h3>
                <p class="text-sm text-gray-600">Ecosystem & Wildlife</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-pink-600 font-semibold">9 Challenges</span>
                    <span class="text-xs bg-pink-100 text-pink-800 px-2 py-1 rounded">All Levels</span>
                </div>
            </div>
            
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-indigo-500" onclick="showChallenges('climate')">
                <div class="text-4xl mb-3">üå°</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Climate Action</h3>
                <p class="text-sm text-gray-600">Global Warming & Solutions</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-indigo-600 font-semibold">7 Challenges</span>
                    <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded">Hard</span>
                </div>
            </div>
            
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-yellow-500" onclick="showChallenges('food')">
                <div class="text-4xl mb-3">ü•¨</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Sustainable Food</h3>
                <p class="text-sm text-gray-600">Agriculture & Nutrition</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-yellow-600 font-semibold">8 Challenges</span>
                    <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">Easy-Medium</span>
                </div>
            </div>
            
            <div class="challenge-card bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-500" onclick="showChallenges('pollution')">
                <div class="text-4xl mb-3">üè≠</div>
                <h3 class="font-bold text-lg text-[#158a8e]">Pollution Control</h3>
                <p class="text-sm text-gray-600">Air, Water & Soil</p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-red-600 font-semibold">10 Challenges</span>
                    <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">Medium-Hard</span>
                </div>
            </div>
        </div>

        <!-- Active Challenge Area -->
        <div id="challengeArea" class="bg-white rounded-xl shadow-lg p-8 hidden">
            <div id="challengeContent">
                <!-- Challenge content will be loaded here -->
            </div>
        </div>

        <!-- Leaderboard Section -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold text-[#158a8e] mb-4 flex items-center">
                <span class="mr-2">üèÖ</span> Today's Leaderboard
            </h2>
            <div id="leaderboard" class="space-y-3">
                <!-- Leaderboard will be populated by JS -->
            </div>
        </div>

        <!-- Enhanced Achievements Panel -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold text-[#158a8e] mb-4 flex items-center">
                <span class="mr-2">üèÜ</span> Achievements & Badges
            </h2>
            <div id="achievementsGrid" class="grid md:grid-cols-6 gap-4">
                <!-- Achievements will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Enhanced Completion Modal -->
    <div id="completionModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 text-center relative overflow-hidden">
            <!-- Celebration particles -->
            <div id="particles"></div>
            <div class="text-6xl mb-4 animate-bounce">üéâ</div>
            <h2 class="text-2xl font-bold text-[#158a8e] mb-2">Challenge Complete!</h2>
            <div id="rewardText" class="text-lg text-[#20c4b6] mb-4"></div>
            <div id="badgeReward" class="mb-6"></div>
            <div id="streakBonus" class="mb-4"></div>
            <button onclick="closeModal()" class="bg-[#20c4b6] text-white px-6 py-3 rounded-lg font-semibold hover:bg-[#1ba89e] transition-colors">
                Continue Learning
            </button>
        </div>
    </div>

    <!-- Game Timer Modal -->
    <div id="timerModal" class="fixed top-4 right-4 bg-white rounded-lg shadow-lg p-4 hidden z-50">
        <div class="text-center">
            <div class="text-sm text-gray-600 mb-1">Time Remaining</div>
            <div class="timer" id="gameTimer">05:00</div>
        </div>
    </div>

    <script>
        // Enhanced Game State
        let gameState = {
            playerXP: 0,
            playerLevel: 1,
            badges: [],
            completedChallenges: [],
            currentStreak: 0,
            todayScore: 0,
            lastPlayDate: null,
            totalChallengesCompleted: 0,
            categoryProgress: {
                water: 0, energy: 0, waste: 0, transport: 0,
                biodiversity: 0, climate: 0, food: 0, pollution: 0
            }
        };

        // Load saved progress
        const savedState = localStorage.getItem('ecoGameState');
        if (savedState) {
            gameState = { ...gameState, ...JSON.parse(savedState) };
        }

        // Enhanced Challenge Database with many more challenges
        const challenges = {
            water: [
                {
                    id: 'water-1',
                    title: 'Water Drop Sorting',
                    type: 'drag-drop',
                    difficulty: 'Easy',
                    description: 'Sort water uses by efficiency level',
                    xp: 50,
                    timeLimit: 300,
                    content: {
                        items: ['Shower (20L/min)', 'Bucket Bath (15L)', 'Dishwasher (12L)', 'Hand Wash Dishes (25L)', 'Washing Machine (50L)', 'Dripping Tap (1L/hour)'],
                        categories: ['Efficient', 'Moderate', 'Wasteful'],
                        correct: {
                            'Efficient': ['Bucket Bath (15L)', 'Dishwasher (12L)'],
                            'Moderate': ['Shower (20L/min)', 'Washing Machine (50L)'],
                            'Wasteful': ['Hand Wash Dishes (25L)', 'Dripping Tap (1L/hour)']
                        }
                    }
                },
                {
                    id: 'water-2',
                    title: 'Water Memory Match',
                    type: 'memory',
                    difficulty: 'Medium',
                    description: 'Match water facts with their values',
                    xp: 60,
                    timeLimit: 180,
                    content: {
                        pairs: [
                            { id: 1, text: 'Daily water need per person', match: '2-3 Liters' },
                            { id: 2, text: 'Water in human body', match: '60%' },
                            { id: 3, text: 'Freshwater on Earth', match: '3%' },
                            { id: 4, text: 'Water for 1kg beef', match: '15,000L' },
                            { id: 5, text: 'Toilet flush volume', match: '6-9L' },
                            { id: 6, text: 'Leaky tap per day', match: '30L' }
                        ]
                    }
                },
                {
                    id: 'water-3',
                    title: 'Virtual Water Calculator',
                    type: 'calculator',
                    difficulty: 'Medium',
                    description: 'Calculate virtual water in everyday products',
                    xp: 70,
                    content: {
                        products: [
                            { name: 'Cotton T-shirt', water: 2700 },
                            { name: 'Cup of Coffee', water: 140 },
                            { name: 'Hamburger', water: 2400 },
                            { name: 'Sheet of Paper', water: 10 }
                        ],
                        goal: 'Calculate total water footprint of daily consumption'
                    }
                },
                {
                    id: 'water-4',
                    title: 'Rainwater Harvesting Simulator',
                    type: 'simulation',
                    difficulty: 'Hard',
                    description: 'Design optimal rainwater collection system',
                    xp: 100,
                    content: {
                        variables: ['roof_area', 'rainfall', 'efficiency', 'storage'],
                        constraints: { budget: 50000, space: 100 },
                        goal: 'Maximize water collection within constraints'
                    }
                },
                {
                    id: 'water-5',
                    title: 'Water Cycle Puzzle',
                    type: 'puzzle',
                    difficulty: 'Easy',
                    description: 'Complete the water cycle diagram',
                    xp: 40,
                    timeLimit: 240,
                    content: {
                        pieces: ['Evaporation', 'Condensation', 'Precipitation', 'Collection', 'Transpiration', 'Infiltration'],
                        correctOrder: ['Evaporation', 'Condensation', 'Precipitation', 'Collection', 'Infiltration', 'Transpiration']
                    }
                },
                {
                    id: 'water-6',
                    title: 'Water Quality Lab',
                    type: 'lab',
                    difficulty: 'Hard',
                    description: 'Test water samples and identify pollutants',
                    xp: 90,
                    content: {
                        samples: [
                            { id: 'A', ph: 6.5, turbidity: 'low', chlorine: 'normal', result: 'Safe' },
                            { id: 'B', ph: 4.2, turbidity: 'high', chlorine: 'low', result: 'Contaminated' },
                            { id: 'C', ph: 8.9, turbidity: 'medium', chlorine: 'high', result: 'Chemical pollution' }
                        ]
                    }
                }
            ],
            energy: [
                {
                    id: 'energy-1',
                    title: 'Solar Panel Builder',
                    type: 'builder',
                    difficulty: 'Medium',
                    description: 'Build optimal solar panel configuration',
                    xp: 80,
                    content: {
                        components: ['Solar Panel', 'Inverter', 'Battery', 'Grid Connection'],
                        constraints: { budget: 100000, space: 50, efficiency: 0.8 }
                    }
                },
                {
                    id: 'energy-2',
                    title: 'Energy Efficiency Race',
                    type: 'race',
                    difficulty: 'Easy',
                    description: 'Race to make a house energy efficient',
                    xp: 50,
                    timeLimit: 120,
                    content: {
                        items: ['LED Bulbs', 'Insulation', 'Smart Thermostat', 'Energy Star Appliances'],
                        efficiencyBonus: [20, 30, 25, 40]
                    }
                },
                {
                    id: 'energy-3',
                    title: 'Wind Farm Strategy',
                    type: 'strategy',
                    difficulty: 'Hard',
                    description: 'Plan optimal wind turbine placement',
                    xp: 120,
                    content: {
                        mapSize: { width: 10, height: 10 },
                        windData: [], // Generated dynamically
                        obstacles: ['Mountain', 'Building', 'Water'],
                        goal: 'Maximize energy output'
                    }
                },
                {
                    id: 'energy-4',
                    title: 'Energy Word Scramble',
                    type: 'word',
                    difficulty: 'Easy',
                    description: 'Unscramble renewable energy terms',
                    xp: 30,
                    timeLimit: 180,
                    content: {
                        words: [
                            { scrambled: 'RLAOS', answer: 'SOLAR' },
                            { scrambled: 'DNWI', answer: 'WIND' },
                            { scrambled: 'DROHY', answer: 'HYDRO' },
                            { scrambled: 'METOALGREH', answer: 'GEOTHERMAL' }
                        ]
                    }
                }
            ],
            waste: [
                {
                    id: 'waste-1',
                    title: 'Recycling Plant Manager',
                    type: 'management',
                    difficulty: 'Hard',
                    description: 'Manage a recycling facility efficiently',
                    xp: 100,
                    content: {
                        materials: ['Plastic', 'Glass', 'Paper', 'Metal'],
                        processes: ['Collection', 'Sorting', 'Processing', 'Manufacturing'],
                        efficiency: 0.75,
                        goal: 'Process maximum materials with minimum waste'
                    }
                },
                {
                    id: 'waste-2',
                    title: 'Composting Timeline',
                    type: 'timeline',
                    difficulty: 'Medium',
                    description: 'Arrange composting process in correct order',
                    xp: 60,
                    content: {
                        stages: [
                            'Add brown materials',
                            'Add green materials', 
                            'Mix thoroughly',
                            'Monitor temperature',
                            'Turn compost',
                            'Harvest finished compost'
                        ],
                        timeframes: ['Week 1', 'Week 1', 'Week 2', 'Week 4', 'Week 8', 'Week 12']
                    }
                }
            ],
            transport: [
                {
                    id: 'transport-1',
                    title: 'Carbon Footprint Calculator',
                    type: 'calculator',
                    difficulty: 'Medium',
                    description: 'Calculate and compare transport emissions',
                    xp: 70,
                    content: {
                        modes: [
                            { name: 'Walking', co2PerKm: 0 },
                            { name: 'Cycling', co2PerKm: 0 },
                            { name: 'Bus', co2PerKm: 0.05 },
                            { name: 'Car', co2PerKm: 0.2 },
                            { name: 'Flight', co2PerKm: 0.25 }
                        ]
                    }
                }
            ],
            biodiversity: [
                {
                    id: 'bio-1',
                    title: 'Ecosystem Builder',
                    type: 'ecosystem',
                    difficulty: 'Hard',
                    description: 'Create a balanced ecosystem',
                    xp: 120,
                    content: {
                        species: ['Producers', 'Primary Consumers', 'Secondary Consumers', 'Decomposers'],
                        balance: { producers: 4, primary: 2, secondary: 1, decomposers: 1 }
                    }
                },
                {
                    id: 'bio-2',
                    title: 'Animal Habitat Match',
                    type: 'matching',
                    difficulty: 'Easy',
                    description: 'Match animals with their habitats',
                    xp: 40,
                    content: {
                        animals: ['Polar Bear', 'Parrot', 'Camel', 'Dolphin'],
                        habitats: ['Arctic', 'Rainforest', 'Desert', 'Ocean']
                    }
                },
                {
                    id: 'bio-3',
                    title: 'Plant Growth Simulator',
                    type: 'growth',
                    difficulty: 'Medium',
                    description: 'Grow plants with optimal conditions',
                    xp: 80,
                    content: {
                        factors: ['Light', 'Water', 'Temperature', 'Nutrients'],
                        stages: ['Seed', 'Sprout', 'Seedling', 'Adult', 'Flowering'],
                        optimal: { light: 70, water: 60, temperature: 25, nutrients: 50 }
                    }
                }
            ],
            climate: [
                {
                    id: 'climate-1',
                    title: 'Greenhouse Effect Demo',
                    type: 'simulation',
                    difficulty: 'Hard',
                    description: 'Understand greenhouse effect through simulation',
                    xp: 100,
                    content: {
                        gases: ['CO2', 'CH4', 'N2O', 'H2O'],
                        effects: [1, 25, 298, 0.1], // Global warming potential
                        scenario: 'Adjust gas concentrations and observe temperature changes'
                    }
                }
            ],
            food: [
                {
                    id: 'food-1',
                    title: 'Sustainable Menu Planner',
                    type: 'planning',
                    difficulty: 'Medium',
                    description: 'Plan a week of sustainable meals',
                    xp: 80,
                    content: {
                        foods: [
                            { name: 'Lentils', co2: 0.9, season: 'All', local: true },
                            { name: 'Beef', co2: 60, season: 'All', local: false },
                            { name: 'Tomatoes', co2: 2.1, season: 'Summer', local: true }
                        ],
                        constraints: { maxCO2: 20, localPercentage: 0.6 }
                    }
                }
            ],
            pollution: [
                {
                    id: 'pollution-1',
                    title: 'Air Quality Monitor',
                    type: 'monitoring',
                    difficulty: 'Hard',
                    description: 'Monitor and analyze air quality data',
                    xp: 90,
                    content: {
                        pollutants: ['PM2.5', 'PM10', 'NO2', 'SO2', 'O3', 'CO'],
                        levels: [25, 50, 40, 20, 120, 9], // Œºg/m¬≥
                        standards: [25, 50, 40, 20, 100, 10],
                        goal: 'Identify pollution sources and solutions'
                    }
                }
            ]
        };

        // Initialize enhanced game
        function initGame() {
            updatePlayerStats();
            loadAchievements();
            loadLeaderboard();
            startDailyTimer();
            checkDailyReset();
        }

        // Check if daily reset is needed
        function checkDailyReset() {
            const today = new Date().toDateString();
            if (gameState.lastPlayDate !== today) {
                gameState.todayScore = 0;
                gameState.lastPlayDate = today;
                saveGameState();
            }
        }

        // Start daily challenge timer
        function startDailyTimer() {
            setInterval(updateDailyTimer, 1000);
        }

        function updateDailyTimer() {
            const now = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const diff = tomorrow - now;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('dailyTimer').textContent = 
                `Resets in: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Enhanced player stats update
        function updatePlayerStats() {
            document.getElementById('playerLevel').textContent = `Level ${gameState.playerLevel}`;
            document.getElementById('playerXP').textContent = `${gameState.playerXP} XP`;
            document.getElementById('playerBadges').textContent = `${gameState.badges.length} üèÜ`;
            document.getElementById('playerStreak').textContent = `${gameState.currentStreak} üî•`;
            document.getElementById('todayScore').textContent = `${gameState.todayScore} ‚≠ê`;
            
            // Enhanced XP progress bar
            const xpForNextLevel = gameState.playerLevel * 100;
            const currentLevelXP = gameState.playerXP % 100;
            const xpProgress = (currentLevelXP / 100) * 100;
            document.getElementById('xpProgress').style.width = `${xpProgress}%`;
            document.getElementById('xpText').textContent = `${currentLevelXP}/100 XP`;
        }

        // Show challenges with enhanced filtering
        function showChallenges(category) {
            const challengeArea = document.getElementById('challengeArea');
            const challengeContent = document.getElementById('challengeContent');
            
            let html = `
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-[#158a8e]">
                        ${getCategoryIcon(category)} ${category.charAt(0).toUpperCase() + category.slice(1)} Challenges
                    </h2>
                    <div class="filter-buttons flex gap-2">
                        <button onclick="filterChallenges('${category}', 'all')" class="px-3 py-1 rounded bg-gray-200 text-sm">All</button>
                        <button onclick="filterChallenges('${category}', 'Easy')" class="px-3 py-1 rounded bg-green-200 text-sm">Easy</button>
                        <button onclick="filterChallenges('${category}', 'Medium')" class="px-3 py-1 rounded bg-yellow-200 text-sm">Medium</button>
                        <button onclick="filterChallenges('${category}', 'Hard')" class="px-3 py-1 rounded bg-red-200 text-sm">Hard</button>
                    </div>
                </div>
                <div class="grid gap-6" id="challengesList">
            `;
            
            const categoryData = challenges[category] || [];
            categoryData.forEach(challenge => {
                const isCompleted = gameState.completedChallenges.includes(challenge.id);
                const difficultyColor = getDifficultyColor(challenge.difficulty);
                html += `
                    <div class="challenge-item border-2 border-gray-200 rounded-lg p-6 ${isCompleted ? 'bg-green-50 border-green-300' : 'bg-gray-50'} cursor-pointer hover:border-[#20c4b6] transition-all" onclick="startChallenge('${challenge.id}', '${category}')">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h3 class="font-bold text-lg text-[#158a8e]">${challenge.title}</h3>
                                    <span class="px-2 py-1 rounded text-xs font-semibold ${difficultyColor}">${challenge.difficulty}</span>
                                    ${challenge.timeLimit ? <span class="text-xs text-gray-500">‚è± ${Math.floor(challenge.timeLimit/60)}:${(challenge.timeLimit%60).toString().padStart(2,'0')}</span> : ''}
                                </div>
                                <p class="text-gray-600 mb-3">${challenge.description}</p>
                                <div class="flex items-center gap-4">
                                    <span class="bg-[#20c4b6] text-white px-3 py-1 rounded-full text-sm font-semibold">+${challenge.xp} XP</span>
                                    <span class="text-sm text-gray-500 capitalize">${challenge.type}</span>
                                    ${isCompleted ? '<span class="text-green-600 text-sm font-semibold">‚úÖ Completed</span>' : ''}
                                </div>
                            </div>
                            <div class="text-3xl ml-4">
                                ${getTypeIcon(challenge.type)}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            challengeContent.innerHTML = html;
            challengeArea.classList.remove('hidden');
            challengeArea.scrollIntoView({ behavior: 'smooth' });
        }

        // Enhanced challenge rendering functions
        function renderMemoryChallenge(challenge) {
            const challengeContent = document.getElementById('challengeContent');
            startTimer(challenge.timeLimit);
            
            // Prepare memory cards
            const pairs = challenge.content.pairs;
            const cards = [];
            pairs.forEach(pair => {
                cards.push({ id: pair.id, content: pair.text, type: 'question' });
                cards.push({ id: pair.id, content: pair.match, type: 'answer' });
            });
            
            // Shuffle cards
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
            
            let html = `
                <div class="challenge-header mb-6">
                    <h2 class="text-2xl font-bold text-[#158a8e] mb-2">${challenge.title}</h2>
                    <p class="text-gray-600">${challenge.description}</p>
                    <div class="mt-4 flex items-center gap-4">
                        <div class="text-sm">Matches Found: <span id="matchCount" class="font-bold text-[#20c4b6]">0</span>/${pairs.length}</div>
                        <div class="text-sm">Attempts: <span id="attemptCount" class="font-bold text-[#fd7e25]">0</span></div>
                    </div>
                </div>
                
                <div class="game-area bg-gray-50 p-6 mb-6">
                    <div class="memory-grid grid grid-cols-4 gap-4 max-w-lg mx-auto">
            `;
            
            cards.forEach((card, index) => {
                html += `
                    <div class="memory-card" data-id="${card.id}" data-content="${card.content}" onclick="flipCard(this)">
                        <div class="memory-card-face memory-card-front">‚ùì</div>
                        <div class="memory-card-face memory-card-back">${card.content}</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            challengeContent.innerHTML = html;
            
            // Initialize memory game state
            window.memoryGame = {
                flippedCards: [],
                matchedPairs: 0,
                attempts: 0,
                totalPairs: pairs.length
            };
        }

        function flipCard(cardElement) {
            if (cardElement.classList.contains('flipped') || window.memoryGame.flippedCards.length >= 2) {
                return;
            }
            
            cardElement.classList.add('flipped');
            window.memoryGame.flippedCards.push(cardElement);
            
            if (window.memoryGame.flippedCards.length === 2) {
                window.memoryGame.attempts++;
                document.getElementById('attemptCount').textContent = window.memoryGame.attempts;
                
                setTimeout(() => checkMemoryMatch(), 1000);
            }
        }

        function checkMemoryMatch() {
            const [card1, card2] = window.memoryGame.flippedCards;
            const id1 = card1.dataset.id;
            const id2 = card2.dataset.id;
            
            if (id1 === id2) {
                // Match found
                window.memoryGame.matchedPairs++;
                document.getElementById('matchCount').textContent = window.memoryGame.matchedPairs;
                
                // Add matched styling
                card1.style.opacity = '0.6';
                card2.style.opacity = '0.6';
                
                createFloatingScore('+10', card1);
                
                if (window.memoryGame.matchedPairs === window.memoryGame.totalPairs) {
                    setTimeout(() => {
                        stopTimer();
                        completeChallenge(getCurrentChallenge());
                    }, 500);
                }
            } else {
                // No match, flip back
                card1.classList.remove('flipped');
                card2.classList.remove('flipped');
            }
            
            window.memoryGame.flippedCards = [];
        }

        function renderEcosystemChallenge(challenge) {
            const challengeContent = document.getElementById('challengeContent');
            
            let html = `
                <div class="challenge-header mb-6">
                    <h2 class="text-2xl font-bold text-[#158a8e] mb-2">${challenge.title}</h2>
                    <p class="text-gray-600">${challenge.description}</p>
                </div>
                
                <div class="game-area bg-gray-50 p-6 mb-6">
                    <div class="flex justify-between items-start">
                        <div class="ecosystem-container">
                            <h3 class="font-bold mb-3">Build Your Ecosystem</h3>
                            <div class="ecosystem-grid bg-green-100 rounded-lg p-2">
            `;
            
            // Create ecosystem grid
            for (let i = 0; i < 100; i++) {
                html += <div class="ecosystem-cell bg-green-200" data-cell="${i}" onclick="placeSpecies(${i})"></div>;
            }
            
            html += `
                            </div>
                        </div>
                        <div class="species-panel ml-6">
                            <h3 class="font-bold mb-3">Species Available</h3>
                            <div class="space-y-2" id="speciesButtons">
                                <button class="species-btn w-full p-2 bg-green-500 text-white rounded" data-species="producers" onclick="selectSpecies('producers')">üå± Producers (${challenge.content.balance.producers})</button>
                                <button class="species-btn w-full p-2 bg-blue-500 text-white rounded" data-species="primary" onclick="selectSpecies('primary')">üê∞ Primary Consumers (${challenge.content.balance.primary})</button>
                                <button class="species-btn w-full p-2 bg-red-500 text-white rounded" data-species="secondary" onclick="selectSpecies('secondary')">ü¶ä Secondary Consumers (${challenge.content.balance.secondary})</button>
                                <button class="species-btn w-full p-2 bg-brown-500 text-white rounded" data-species="decomposers" onclick="selectSpecies('decomposers')">üçÑ Decomposers (${challenge.content.balance.decomposers})</button>
                            </div>
                            <div class="mt-4">
                                <div class="text-sm">Balance Score: <span id="balanceScore" class="font-bold">0%</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center">
                    <button onclick="checkEcosystemBalance()" class="bg-[#20c4b6] text-white px-6 py-3 rounded-lg font-semibold hover:bg-[#1ba89e] transition-colors">
                        Check Ecosystem Balance
                    </button>
                </div>
            `;
            
            challengeContent.innerHTML = html;
            
            // Initialize ecosystem game state
            window.ecosystemGame = {
                selectedSpecies: null,
                placed: { producers: 0, primary: 0, secondary: 0, decomposers: 0 },
                target: challenge.content.balance
            };
        }

        function renderGrowthChallenge(challenge) {
            const challengeContent = document.getElementById('challengeContent');
            
            let html = `
                <div class="challenge-header mb-6">
                    <h2 class="text-2xl font-bold text-[#158a8e] mb-2">${challenge.title}</h2>
                    <p class="text-gray-600">${challenge.description}</p>
                </div>
                
                <div class="game-area bg-gradient-to-b from-blue-100 to-green-100 p-6 mb-6">
                    <div class="flex justify-between items-end">
                        <div class="plant-container text-center">
                            <div class="plant-stage text-6xl" id="plantStage">üå±</div>
                            <div class="text-sm mt-2">Growth Stage: <span id="currentStage">Seed</span></div>
                        </div>
                        <div class="controls-panel bg-white p-4 rounded-lg shadow">
                            <h3 class="font-bold mb-3">Growing Conditions</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-sm">Light: <span id="lightValue">50</span>%</label>
                                    <input type="range" id="lightSlider" min="0" max="100" value="50" class="w-full" oninput="updateGrowth()">
                                </div>
                                <div>
                                    <label class="text-sm">Water: <span id="waterValue">50</span>%</label>
                                    <input type="range" id="waterSlider" min="0" max="100" value="50" class="w-full" oninput="updateGrowth()">
                                </div>
                                <div>
                                    <label class="text-sm">Temperature: <span id="tempValue">20</span>¬∞C</label>
                                    <input type="range" id="tempSlider" min="0" max="40" value="20" class="w-full" oninput="updateGrowth()">
                                </div>
                                <div>
                                    <label class="text-sm">Nutrients: <span id="nutrientValue">50</span>%</label>
                                    <input type="range" id="nutrientSlider" min="0" max="100" value="50" class="w-full" oninput="updateGrowth()">
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="text-sm">Growth Rate: <span id="growthRate" class="font-bold text-green-600">0%</span></div>
                                <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                    <div class="bg-green-500 h-2 rounded-full transition-all" id="growthBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            challengeContent.innerHTML = html;
            
            // Initialize growth game
            window.growthGame = {
                currentStage: 0,
                stages: ['üå±', 'üåø', 'ü™¥', 'üå≥', 'üå∏'],
                stageNames: ['Seed', 'Sprout', 'Seedling', 'Adult', 'Flowering'],
                growth: 0,
                optimal: challenge.content.optimal
            };
            
            updateGrowth();
        }

        function updateGrowth() {
            const light = parseInt(document.getElementById('lightSlider').value);
            const water = parseInt(document.getElementById('waterSlider').value);
            const temp = parseInt(document.getElementById('tempSlider').value);
            const nutrients = parseInt(document.getElementById('nutrientSlider').value);
            
            // Update display values
            document.getElementById('lightValue').textContent = light;
            document.getElementById('waterValue').textContent = water;
            document.getElementById('tempValue').textContent = temp;
            document.getElementById('nutrientValue').textContent = nutrients;
            
            // Calculate growth rate based on optimal conditions
            const optimal = window.growthGame.optimal;
            const lightScore = 100 - Math.abs(light - optimal.light);
            const waterScore = 100 - Math.abs(water - optimal.water);
            const tempScore = 100 - Math.abs(temp - optimal.temperature) * 2;
            const nutrientScore = 100 - Math.abs(nutrients - optimal.nutrients);
            
            const growthRate = Math.max(0, (lightScore + waterScore + tempScore + nutrientScore) / 4);
            
            document.getElementById('growthRate').textContent = Math.round(growthRate) + '%';
            document.getElementById('growthBar').style.width = growthRate + '%';
            
            // Update plant growth
            window.growthGame.growth += growthRate / 100;
            const newStage = Math.min(4, Math.floor(window.growthGame.growth / 20));
            
            if (newStage !== window.growthGame.currentStage) {
                window.growthGame.currentStage = newStage;
                document.getElementById('plantStage').textContent = window.growthGame.stages[newStage];
                document.getElementById('currentStage').textContent = window.growthGame.stageNames[newStage];
                
                if (newStage === 4) {
                    setTimeout(() => {
                        completeChallenge(getCurrentChallenge());
                    }, 1000);
                }
            }
        }

        // Timer functions
        function startTimer(seconds) {
            if (!seconds) return;
            
            document.getElementById('timerModal').classList.remove('hidden');
            
            window.gameTimer = {
                remaining: seconds,
                interval: setInterval(() => {
                    window.gameTimer.remaining--;
                    const minutes = Math.floor(window.gameTimer.remaining / 60);
                    const secs = window.gameTimer.remaining % 60;
                    document.getElementById('gameTimer').textContent = 
                        document.getElementById('gameTimer').textContent = `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                    
                    if (window.gameTimer.remaining <= 0) {
                        stopTimer();
                        alert('Time\'s up! Try again to improve your time.');
                    }
                }, 1000)
            };
        }

        function stopTimer() {
            if (window.gameTimer) {
                clearInterval(window.gameTimer.interval);
                document.getElementById('timerModal').classList.add('hidden');
                window.gameTimer = null;
            }
        }

        // Enhanced completion with particles
        function showCompletionModal(challenge, leveledUp) {
            const modal = document.getElementById('completionModal');
            const rewardText = document.getElementById('rewardText');
            const badgeReward = document.getElementById('badgeReward');
            const streakBonus = document.getElementById('streakBonus');
            
            // Create celebration particles
            createParticles();
            
            let text = `You earned ${challenge.xp} XP!`;
            if (leveledUp) {
                text += ` üéâ Level Up! You're now Level ${gameState.playerLevel}!`;
            }
            
            // Add time bonus if applicable
            if (window.gameTimer && window.gameTimer.remaining > 0) {
                const timeBonus = Math.floor(window.gameTimer.remaining / 10);
                text += ` ‚ö° Time Bonus: +${timeBonus} XP!`;
                gameState.playerXP += timeBonus;
            }
            
            rewardText.textContent = text;
            
            // Show streak bonus
            if (gameState.currentStreak > 1) {
                streakBonus.innerHTML = <div class="text-sm text-[#fd7e25]">üî• ${gameState.currentStreak} Day Streak! Bonus XP!</div>;
            }
            
            modal.classList.remove('hidden');
        }

        function createParticles() {
            const particles = document.getElementById('particles');
            particles.innerHTML = '';
            
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 2 + 's';
                particles.appendChild(particle);
            }
        }

        function createFloatingScore(text, element) {
            const score = document.createElement('div');
            score.className = 'floating-score';
            score.textContent = text;
            score.style.left = element.offsetLeft + 'px';
            score.style.top = element.offsetTop + 'px';
            element.parentNode.appendChild(score);
            
            setTimeout(() => score.remove(), 1000);
        }

        // Utility functions
        function getDifficultyColor(difficulty) {
            switch (difficulty) {
                case 'Easy': return 'bg-green-100 text-green-800';
                case 'Medium': return 'bg-yellow-100 text-yellow-800';
                case 'Hard': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getTypeIcon(type) {
            const icons = {
                'drag-drop': 'üéØ',
                'memory': 'üß†',
                'quiz': '‚ùì',
                'calculator': 'üßÆ',
                'simulation': '‚öó',
                'puzzle': 'üß©',
                'builder': 'üèó',
                'race': 'üèÉ',
                'strategy': '‚ôü',
                'word': 'üìù',
                'ecosystem': 'üåç',
                'growth': 'üå±',
                'management': 'üìä',
                'timeline': 'üìÖ',
                'matching': 'üîó',
                'lab': 'üî¨',
                'planning': 'üìã',
                'monitoring': 'üì°'
            };
            return icons[type] || 'üéÆ';
        }

        function getCategoryIcon(category) {
            const icons = {
                water: 'üíß',
                energy: '‚ö°',
                waste: '‚ôª',
                transport: 'üö≤',
                biodiversity: 'üåø',
                climate: 'üå°',
                food: 'ü•¨',
                pollution: 'üè≠'
            };
            return icons[category] || 'üåç';
        }

        function getCurrentChallenge() {
            // This would track the current challenge being played
            return window.currentChallenge;
        }

        function saveGameState() {
            localStorage.setItem('ecoGameState', JSON.stringify(gameState));
        }

        function loadLeaderboard() {
            // Mock leaderboard data
            const leaderboard = [
                { name: 'EcoWarrior', score: 2500, level: 12 },
                { name: 'GreenGamer', score: 2200, level: 11 },
                { name: 'You', score: gameState.playerXP, level: gameState.playerLevel },
                { name: 'NatureLover', score: 1800, level: 9 },
                { name: 'ClimateHero', score: 1500, level: 8 }
            ];
            
            leaderboard.sort((a, b) => b.score - a.score);
            
            const leaderboardElement = document.getElementById('leaderboard');
            let html = '';
            
            leaderboard.slice(0, 5).forEach((player, index) => {
                const medal = index < 3 ? ['ü•á', 'ü•à', 'ü•â'][index] : `#${index + 1}`;
                const isPlayer = player.name === 'You';
                html += `
                    <div class="flex items-center justify-between p-3 ${isPlayer ? 'bg-[#e1f7ef] border border-[#20c4b6]' : 'bg-gray-50'} rounded-lg">
                        <div class="flex items-center gap-3">
                            <span class="text-lg">${medal}</span>
                            <span class="font-semibold ${isPlayer ? 'text-[#20c4b6]' : ''}">${player.name}</span>
                            <span class="text-sm text-gray-500">Level ${player.level}</span>
                        </div>
                        <span class="font-bold text-[#fd7e25]">${player.score} XP</span>
                    </div>
                `;
            });
            
            leaderboardElement.innerHTML = html;
        }

        function loadAchievements() {
            const achievementsGrid = document.getElementById('achievementsGrid');
            const allBadges = [
                { id: 'first-challenge', name: 'First Steps', icon: 'üå±', description: 'Complete your first challenge' },
                { id: 'water-expert', name: 'Water Expert', icon: 'üíß', description: 'Complete 3 water challenges' },
                { id: 'energy-saver', name: 'Energy Saver', icon: '‚ö°', description: 'Complete 3 energy challenges' },
                { id: 'streak-master', name: 'Streak Master', icon: 'üî•', description: 'Maintain a 7-day streak' },
                { id: 'speed-demon', name: 'Speed Demon', icon: '‚ö°', description: 'Complete challenge in record time' },
                { id: 'perfectionist', name: 'Perfectionist', icon: 'üíé', description: 'Score 100% on 5 challenges' },
                { id: 'eco-champion', name: 'Eco Champion', icon: 'üèÜ', description: 'Complete 25 challenges' },
                { id: 'knowledge-seeker', name: 'Knowledge Seeker', icon: 'üìö', description: 'Try all challenge types' },
                { id: 'daily-warrior', name: 'Daily Warrior', icon: 'üóì', description: 'Complete daily challenges for a week' },
                { id: 'eco-master', name: 'Eco Master', icon: 'üëë', description: 'Reach Level 10' }
            ];
            
            let html = '';
            allBadges.forEach(badge => {
                const earned = gameState.badges.includes(badge.id);
                html += `
                    <div class="text-center p-3 ${earned ? 'bg-gradient-to-br from-yellow-100 to-yellow-200 border-2 border-yellow-400' : 'bg-gray-50 border border-gray-200'} rounded-lg transition-all hover:scale-105" title="${badge.description}">
                        <div class="text-3xl mb-2 ${earned ? 'badge' : 'grayscale opacity-30'}">${badge.icon}</div>
                        <div class="font-semibold text-xs ${earned ? 'text-yellow-700' : 'text-gray-400'}">${badge.name}</div>
                    </div>
                `;
            });
            
            achievementsGrid.innerHTML = html;
        }

        // Initialize the game when page loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
